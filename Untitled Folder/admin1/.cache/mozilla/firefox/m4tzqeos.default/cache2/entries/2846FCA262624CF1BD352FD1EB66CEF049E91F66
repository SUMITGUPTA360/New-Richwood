/** Version 6**/

/****************************************************** 
  Help Center Restrict End User Options - START
/******************************************************/  

if (typeof (hide_option_keys) == 'undefined') {
	if (typeof (console) != 'undefined') {
		console.warn("CloudSET :: HelpCenter Restrict End-User Options - hide_option_keys not defined; widget will be disabled");
	}
} else {
	function convertFieldId(fieldId) {
		result = fieldId;
		if (fieldId && fieldId.indexOf("ticket_fields_") > -1) {
			result = "request_custom_fields_" + fieldId.substring(14);
		}
		return result;
	}
	
	function stripId(fieldId) {
		result = fieldId;
		if (fieldId && fieldId.indexOf("request_custom_fields_") > -1) {
			result = fieldId.substring(22);
		}
		return result;
	}

	// Return the option key corresponding to the system field id on the form
	// Only supports priority and type
	function getSystemFieldId(fieldId) {
    if (fieldId=="request_priority") {
			return "ticket_priority_id";
		} else if (fieldId=="request_type") {
			return "ticket_ticket_type_id";
		}
		return null;
	}
	
	function propertyFromId(id, jMap) {
		var result = null;
		for ( var i in jMap) {
			var jItem = jMap[i];
			if (jItem && jItem.id == id) {
				result = i;
			}
		}
		return result;
	}
	
	// Finds the nesty-panel at the bottom of the page that has
	// had a <ul> and <li> options built inside it to provide the menu
	// Scan over these options and remove those with ids that match
	// the configuration data.
	// The fieldId represents the ticket field to which the menu belongs
	// and is used to index into the configuration structure.
	function removeOptions(fieldId) {
		var menu = $("div.nesty-panel ul");
		if (menu[0]) {
			for (i = 0; i < hide_option_keys.length; i++) {
				var hide_option = hide_option_keys[i];
				var hide_key = hide_option[0];
				// only process the definitions from the passed field id
				if (hide_key==fieldId) {
					var hide_option = hide_option_keys[i];
					var hide_entries = hide_option[1];
					menu.find("li").each(function() {
						var itemId = this.id;
						if (itemId==null || itemId=="null" || itemId=="") {
							itemId="-";
						}
						if (_.contains(hide_entries, itemId)) {
							$(this).remove();
						}
					});
				}
			}
		}
	}

	// Finds the nesty-panel at the bottom of the page that has
	// had a <ul> and <li> options built inside it to provide the menu
	// Scan over these options and remove those with ids that match
	// the configuration data. This is done by ordinal position for system fields not by id values
	// The fieldId represents the ticket field to which the menu belongs
	// and is used to index into the configuration structure.
	function removeSysFieldOptions(fieldId) {
		var $menu = $("div.nesty-panel ul");
		if ($menu[0]) {
			for (i = 0; i < hide_option_keys.length; i++) {
				var hide_option = hide_option_keys[i];
				var hide_key = hide_option[0];
				// only process the definitions from the passed field id
				if (hide_key==fieldId) {
					var hide_option = hide_option_keys[i];
					var hide_entries = hide_option[1];
					var $lis = $menu.find("li");
					var lisLength = $lis.length;
					for (var i=0; i<lisLength; i++) {
						var $li = $lis[i];
						if (_.contains(hide_entries, i.toString())) {
							// found a matching hide configuration setting so remove from HTML
							$li.remove(); // remove from UL list
						}
					}
				}
			}
		}
	}


	function removeOptionsIE() {
	  removeOptions(selectedFieldId);
	}

	function removeSysFieldOptionsIE() {
		removeSysFieldOptions(selectedFieldId);
	}
	
	function addClickHandlers() {
    // scan for nesty span fields and add our own click handler to
    // alter the menu options when they appear.
    // The menu is created each time by the HelpCenter library script
    // There is no fixed combo on the page except for system fields and these are hidden anyway and are there just to hold the selected value.
		// They still use a dynamically created ul li list to present the options that we must intercept
    var iev = getIEVersion();
    var selectedFieldId = null;
    var $inputs = $("div.form-field span.nesty-input, div.form-field a.nesty-input");
    $inputs.each(function() {
      var nestySpan = $(this);
      var input = nestySpan.parent().find("input[data-tagger]");
      if (input[0]) {
        var id = input[0].id;
        var fieldId = stripId(id);
        // add a handler and pass the field id through to index
        // into the relevant part of the configuration data
        nestySpan.click(fieldId,function() {
          selectedFieldId = "ticket_fields_" + fieldId;
          if (iev && iev<9) {
            setTimeout(removeOptionsIE,100);
          } else {
            removeOptions("ticket_fields_" + fieldId);
          }
        });
      } else {
				// if we didn't find and input we still need to add handlers to the system fields for priority and type
				// These have actual hidden combos (select elements) to hold the selected value but still
				// use a dynamically created ul li list to present the options that we must intercept
				// We only support and add handlers to priority and type
				// getSystemFieldId will return null for other combos so that click handlers are not attached to these
				var select = nestySpan.parent().find("select");
				if (select[0]) {
					var id = select[0].id;
					var sysFieldId = getSystemFieldId(id); // check if it is a priority or type field, returns null if neither of these
					if (sysFieldId) {
						// add a handler and pass the field id through to index
						// into the relevant part of the configuration data
						nestySpan.click(sysFieldId, function () {
							selectedFieldId = sysFieldId;
							if (iev && iev < 9) {
								setTimeout(removeSysFieldOptionsIE, 100);
							} else {
								removeSysFieldOptions(sysFieldId);
							}
						});
					}
				}
			}
    });
	}

	// Remove the options from the system field combos even though these are not actually
	// used to present the options to the user. They simply hold the selected value
	// However if after removal there is only one option left or none - hide the field completely
	// A click handler is still added by addClickHandlers() to remove the same dynamic options
	function restrictHideSystemField(hide_option,fieldId) {
		// Find the priority field div by class
		var $select = $("div.form-field select#"+fieldId);
		if ($select[0]) {
			var hide_entries = hide_option[1];
			var $options = $select.find("option");
			var optionsLength = $options.length;
			for (var i=0; i<optionsLength; i++) {
				var $option = $options[i];
				if (_.contains(hide_entries, i.toString())) {
					// found a matching hide configuration setting so remove from HTML
					$option.remove(); // remove from the HTML combo
				}
			}
			var $newOptions = $select.find("option");
			if ($newOptions.length<2) {
				// hide the field completely
				$select.parent().hide();
			} else if ($newOptions.length!=optionsLength) {
				// We have altered the options so make sure we
				// set the first option value from the updated list as the value that is visible in the nesty input
				var firstOption = $newOptions[0];
				var firstOptionVal = $(firstOption).html();
				var nestyInput = $select.parent().find("a.nesty-input");
				if (nestyInput[0]) {
					$(nestyInput[0]).html(firstOptionVal);
				}
			}
		} else {
			console.error("CloudSET :: Help Center Restrict End-User Options Error - Unable to find priority system combo");
		}
	}

	// Restrict End User options only applies to two system fields, priority and type
	// In HelpCenter these fields exists as real HTML Combos (select elements)
	// unlike other custom fields whose combos are constructed on the fly as a DIV UL structure when clicked
	// We need to check if priority or type are mentioned in the configuration keys
	function restrictHideSystemFields() {
		for (i = 0; i < hide_option_keys.length; i++) {
			var hide_option = hide_option_keys[i];
			var hide_field = hide_option[0];
			// only process the definitions from the passed field id
			if (hide_field == "ticket_priority_id") {
				restrictHideSystemField(hide_option, "request_priority");
			} else if (hide_field == "ticket_ticket_type_id") {
				restrictHideSystemField(hide_option, "request_type");
			}
		}
	}

	// Return just the values from the data-tagger json structure
	// but return "-" for the special case of the empty value because
	// "-" is the value we use for empty in our RestrictEndUserOptions config structure
	// and "" would not match
  function getDataTaggerValues(dataTagger) {
		var result = [];
		for (var i in dataTagger) {
			var pair = dataTagger[i];
			if (pair.value=="") {
				result.push("-");
			} else {
				result.push(pair.value);
			}
		}
		return result;
	}

	// Determine if only one (or no) values are applicable to each custom field that we are restricting
	// If so hide the field
	// If one value is still applicable directly set it as the value of the input so it is respected
	// on submission
	function setAndHideSingleValueCustomFields() {
		for (i = 0; i < hide_option_keys.length; i++) {
			var hide_option = hide_option_keys[i];
			var hide_key = hide_option[0];
			// only process the definitions from the passed field id
			if (hide_key.indexOf("ticket_fields_")==0) {
				// this rule is for a custom field not a system field so find its corresponding input field
				// and use its data tagger field to determine the set of possible value
				// If all its values, or all its values except one are specified in the hidden values
				// then hide the entire field
				var inputId = "request_custom_fields_" + hide_key.substring(14);
				var $input = $("div.form-field input#"+inputId);
				if ($input[0]) {
					var dataTaggerAttr = $input.attr("data-tagger");
					if (dataTaggerAttr!=null && dataTaggerAttr!="") {
						var dataTagger = JSON.parse(dataTaggerAttr);
						var dtValues = getDataTaggerValues(dataTagger);
						var numValues = dtValues.length;
						var hide_entries = hide_option[1];
						var firstVisibleValue = null;
						var firstVisiblePos = -1;
						var lastValue = null;
						for (var j=0; j<dtValues.length; j++) {
							var dtValue = dtValues[j];
							if (_.contains(hide_entries, dtValue)) {
								numValues--;  // decrement the original num of data tagger values for each match
							} else {
								if (firstVisiblePos==-1) {
									firstVisiblePos = j;
								}
								if (firstVisibleValue==null) {
									firstVisibleValue=dtValue;
								}
								lastValue = dtValue; // remember the last value in case we need it
							}
						}
						if (numValues < 2) {
							// after comparing all values there is either just the one selection or no selections left
							// So hide the whole field
							$input.parent().hide();
							if (numValues==1 && lastValue!=null) {
								$input.val(lastValue);
							}
						} else {
							// set the first visible value on the input if not the first possible value
							if (firstVisiblePos>0 && firstVisibleValue!=null) {
								$input.val(firstVisibleValue);
							}
						}
					} else {
						console.error("CloudSET :: Help Center Restrict End-User Options Error - No data-tagger attribute on input with id  '" + inputId + "'. Rule cannot be processed");
					}
				} else {
					console.error("CloudSET :: Help Center Restrict End-User Options Error - Failed to find input field with id '" + inputId + "' corresponding to rule " + hide_key);
				}
			}
		}
	}

	function processPage() {
		addClickHandlers();
		restrictHideSystemFields();
		setAndHideSingleValueCustomFields();
	}
	
	try {
		// Hide specific options from a drop-down - for end-users
		if ((location.pathname.indexOf('/requests/new') > -1 || location.pathname.indexOf('/anonymous_requests/new') > -1 )) {
			$(function nestys() {
        setTimeout(processPage,1000);
			});
		}
	} catch (err) {
		if (typeof (console) != 'undefined') {
			console.error("CloudSET :: Help Center Restrict End-User Options Error - " + err);
		}
	}
}
/****************************************************** 
Help Center Restrict End User Options - END
/******************************************************/  
¼^ƒSì      Y{DY{E=²bª       ^:https://prod.global.ssl.fastly.net/jswdeploy?action=widget&domain=twilio.zendesk.com&id=25181 necko:classified 1 security-info FnhllAKWRHGAlo+ESXykKAAAAAAAAAAAwAAAAAAAAEaphjojH6pBabDSgSnsfLHeAAQAAgAAAAAAAAAAAAAAAAAAAAAB4vFIJp5wRkeyPxAQ9RJGKPqbqVvKO0mKuIl8ec8o/uhmCjImkVxP+7sgiYWmMt8F+O2DZM7ZTG6GukivU8OT5gAAAAAAAAvtMIIL6TCCCtGgAwIBAgIQBigdNnW0H8yz/xj67Pj93zANBgkqhkiG9w0BAQsFADBwMQswCQYDVQQGEwJVUzEVMBMGA1UEChMMRGlnaUNlcnQgSW5jMRkwFwYDVQQLExB3d3cuZGlnaWNlcnQuY29tMS8wLQYDVQQDEyZEaWdpQ2VydCBTSEEyIEhpZ2ggQXNzdXJhbmNlIFNlcnZlciBDQTAeFw0xNDEyMDgwMDAwMDBaFw0xODAyMDYxMjAwMDBaMGwxCzAJBgNVBAYTAlVTMRMwEQYDVQQIEwpDYWxpZm9ybmlhMRYwFAYDVQQHEw1TYW4gRnJhbmNpc2NvMRUwEwYDVQQKEwxGYXN0bHksIEluYy4xGTAXBgNVBAMTEGEuc3NsLmZhc3RseS5uZXQwggEiMA0GCSqGSIb3DQEBAQUAA4IBDwAwggEKAoIBAQDUJUiQsaVP/vC4Mb3aJUmA9KnMQa7EJfjYLsE4F0VehrOp8jlSSXmQLELlUAwPp2F2PNyB32DDOFBHZIYwFrApFEzsJdTKQUYk6xHPZOdYoIijpmfb5xRMdTjqxThGkk+khU0+ipPWiErJNRkapLgPwPD4ctd5X8rnKF8lMHIxx5Xhdg6PqZC3F7y45Nym2a3M8xIKIkB77o1bkuDpGnV9ZESC/Yf9Mc4NmWrQjqQc+8yIabir+n7/YcM5UdUjZPNShgL4jLYVJ+KDRZcjIT/dXRZoPpJgRFL9NIep/eSAzQa3g659uW7tjN6tg5iQm4hwksaWp+zfTAJc4IXNtlndAgMBAAGjggiBMIIIfTAfBgNVHSMEGDAWgBRRaP+QrwIHdTzM2WVkYqISuFlyOzAdBgNVHQ4EFgQUwIj0Y03ka1Q28RLCtKWy4nN7FIgwggaxBgNVHREEggaoMIIGpIIQYS5zc2wuZmFzdGx5Lm5ldIISKi5hLnNzbC5mYXN0bHkubmV0gg9mYXN0Lndpc3RpYS5jb22CEHB1cmdlLmZhc3RseS5uZXSCEm1pcnJvcnMuZmFzdGx5Lm5ldIIOKi5wYXJzZWNkbi5jb22CDSouZmFzdHNzbC5uZXSCCXZveGVyLmNvbYINd3d3LnZveGVyLmNvbYIOKi5maXJlYmFzZS5jb22CEHNpdGVzLnlhbW1lci5jb22CGHNpdGVzLnN0YWdpbmcueWFtbWVyLmNvbYIPKi5za2ltbGlua3MuY29tghMqLnNraW1yZXNvdXJjZXMuY29tghBjZG4udGhpbmdsaW5rLm1lggwqLmZpdGJpdC5jb22CEiouaG9zdHMuZmFzdGx5Lm5ldIISY29udHJvbC5mYXN0bHkubmV0gg8qLndpa2lhLWluYy5jb22CFSoucGVyZmVjdGF1ZGllbmNlLmNvbYILKi53aWtpYS5jb22CEmYuY2xvdWQuZ2l0aHViLmNvbYIVKi5kaWdpdGFsc2Npcm9jY28ubmV0ggoqLmV0c3kuY29tghAqLmV0c3lzdGF0aWMuY29tgg0qLmFkZHRoaXMuY29tghAqLmFkZHRoaXNjZG4uY29tgg9mYXN0Lndpc3RpYS5uZXSCDnJhdy5naXRodWIuY29tgg93d3cudXNlcmZveC5jb22CEyouYXNzZXRzLXlhbW1lci5jb22CGyouc3RhZ2luZy5hc3NldHMteWFtbWVyLmNvbYIWYXNzZXRzLmh1Z2dpZXMtY2RuLm5ldIISb3JiaXQuc2hhemFtaWQuY29tgg9hYm91dC5qc3Rvci5vcmeCFyouZ2xvYmFsLnNzbC5mYXN0bHkubmV0gg13ZWIudm94ZXIuY29tgg9weXBpLnB5dGhvbi5vcmeCCyouMTJ3YnQuY29tghJ3d3cuaG9sZGVyZGVvcmQubm+CGnNlY3VyZWQuaW5kbi5pbmZvbGlua3MuY29tghBwbGF5LnZpZHlhcmQuY29tghhwbGF5LXN0YWdpbmcudmlkeWFyZC5jb22CFXNlY3VyZS5pbWcud2ZyY2RuLmNvbYIWc2VjdXJlLmltZy5qb3NzY2RuLmNvbYIQKi5nb2NhcmRsZXNzLmNvbYIVd2lkZ2V0cy5waW50ZXJlc3QuY29tgg4qLjdkaWdpdGFsLmNvbYINKi43c3RhdGljLmNvbYIPcC5kYXRhZG9naHEuY29tghBuZXcubXVsYmVycnkuY29tghJ3d3cuc2FmYXJpZmxvdy5jb22CEmNkbi5jb250ZW50ZnVsLmNvbYIQdG9vbHMuZmFzdGx5Lm5ldIISKi5odWV2b3NidWVub3MuY29tgg4qLmdvb2RlZ2dzLmNvbYIWKi5mYXN0bHkucGljbW9ua2V5LmNvbYIVKi5jZG4ud2hpcHBsZWhpbGwubmV0ghEqLndoaXBwbGVoaWxsLm5ldIIbY2RuLm1lZGlhMzQud2hpcHBsZWhpbGwubmV0ghtjZG4ubWVkaWE1Ni53aGlwcGxlaGlsbC5uZXSCG2Nkbi5tZWRpYTc4LndoaXBwbGVoaWxsLm5ldIIcY2RuLm1lZGlhOTEwLndoaXBwbGVoaWxsLm5ldIIOKi5tb2RjbG90aC5jb22CDyouZGlzcXVzY2RuLmNvbYILKi5qc3Rvci5vcmeCDyouZHJlYW1ob3N0LmNvbYIOd3d3LmZsaW50by5jb22CDyouY2hhcnRiZWF0LmNvbYINKi5oaXBtdW5rLmNvbYIaY29udGVudC5iZWF2ZXJicm9va3MuY28udWuCG3NlY3VyZS5jb21tb24uY3Nuc3RvcmVzLmNvbYIOd3d3LmpvaW5vcy5jb22CJXN0YWdpbmctbW9iaWxlLWNvbGxlY3Rvci5uZXdyZWxpYy5jb22CDioubW9kY2xvdGgubmV0ghAqLmZvdXJzcXVhcmUuY29tggwqLnNoYXphbS5jb22CCiouNHNxaS5uZXSCDioubWV0YWNwYW4ub3JnggwqLmZhc3RseS5jb22CCXdpa2lhLmNvbYIKZmFzdGx5LmNvbYIRKi5nYWR2ZW50dXJlcy5jb22CFnd3dy5nYWR2ZW50dXJlcy5jb20uYXWCFXd3dy5nYWR2ZW50dXJlcy5jby51a4IJa3JlZG8uY29tghZjZG4tdGFncy5icmFpbmllbnQuY29tghRteS5iaWxsc3ByaW5nYXBwLmNvbYIGcnZtLmlvMA4GA1UdDwEB/wQEAwIFoDAdBgNVHSUEFjAUBggrBgEFBQcDAQYIKwYBBQUHAwIwdQYDVR0fBG4wbDA0oDKgMIYuaHR0cDovL2NybDMuZGlnaWNlcnQuY29tL3NoYTItaGEtc2VydmVyLWc1LmNybDA0oDKgMIYuaHR0cDovL2NybDQuZGlnaWNlcnQuY29tL3NoYTItaGEtc2VydmVyLWc1LmNybDBMBgNVHSAERTBDMDcGCWCGSAGG/WwBATAqMCgGCCsGAQUFBwIBFhxodHRwczovL3d3dy5kaWdpY2VydC5jb20vQ1BTMAgGBmeBDAECAjCBgwYIKwYBBQUHAQEEdzB1MCQGCCsGAQUFBzABhhhodHRwOi8vb2NzcC5kaWdpY2VydC5jb20wTQYIKwYBBQUHMAKGQWh0dHA6Ly9jYWNlcnRzLmRpZ2ljZXJ0LmNvbS9EaWdpQ2VydFNIQTJIaWdoQXNzdXJhbmNlU2VydmVyQ0EuY3J0MAwGA1UdEwEB/wQCMAAwDQYJKoZIhvcNAQELBQADggEBAKLWzbX7wSyjzE7BVMjLrHAaiz+WGSwrAPrQBJ29sqouu9gvI7i2Ie6eiRb4YLMouy6D+ZNZ+RM+Hkjv+PZFxCcDRmaWi+74ha5d8O155gRJRPZ0Sy5SfD/8kqrJRfC+/D/KdQzOroD4sx6Qprs9lZ0IEn4CTf0YPNV+Cps37LsVyPJLfjDlGIM5K3B/vtZfn2f8buQ9QyKiN0bc67GdCjih9dSrkQNkxJiEOwqiSjYtkdFOdYpXF8d1rQKV7a6z2vJloDwilfXLLlUX7rA3qVu7r4EUfIsZgH7hgB4bbst7tx+7PgUEq2334kKPVFpsxgsj5++k4lh7tNlakXiBUtzALwADAAAAAAEBAAA= request-method GET response-head HTTP/1.1 200 OK
Content-Type: text/javascript;charset=UTF-8
Server: Apache-Coyote/1.1
Content-Length: 12576
Accept-Ranges: bytes
Date: Thu, 27 Apr 2017 13:17:47 GMT
Via: 1.1 varnish
Age: 142777
X-Served-By: cache-sin18021-SIN
X-Cache: HIT
X-Cache-Hits: 15
X-Timer: S1493299068.867765,VS0,VE0
 uncompressed-len 0   1 